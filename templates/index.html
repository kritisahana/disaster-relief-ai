<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Disaster Relief ‚Äî GA + Routes</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; background:#f6f8fb; }
    h2 { color:#0b5b6f; }
    table { border-collapse: collapse; width:100%; background:white; }
    th, td { border: 1px solid #ddd; padding:8px; text-align:center; }
    th { background:#0b7a86; color:white; }
    input, select { padding:6px; width:100%; box-sizing:border-box; }
    .btn { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; color:white; }
    .btn-add { background:#28a745; }
    .btn-opt { background:#007bff; }
    .btn-remove { background:#dc3545; }
    .container { max-width:1100px; }
    .row { display:flex; gap:20px; margin-top:20px; }
    .left { flex:1; }
    .right { width:480px; }
    .card { background:white; padding:12px; border-radius:8px; box-shadow:0 1px 6px rgba(0,0,0,0.06); }
    .message { font-weight:bold; color:#d9534f; margin-top:10px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Disaster Relief ‚Äî Resource GA & Route Planner</h2>

    <form id="mainForm" method="post">
      <div class="card">
        <h3>Areas (add coordinates)</h3>
        <table id="areaTable">
          <thead>
            <tr>
              <th>Area</th><th>Population</th><th>Need</th><th>X</th><th>Y</th><th>Remove</th>
            </tr>
          </thead>
          <tbody id="areaBody">
            <tr>
              <td><input name="area1" required></td>
              <td><input name="pop1" type="number" value="0" required></td>
              <td><input name="need1" placeholder="Food/Water/Medical" required></td>
              <td><input name="x1" type="number" step="any" value="0" required></td>
              <td><input name="y1" type="number" step="any" value="0" required></td>
              <td><button type="button" class="btn btn-remove" onclick="removeRow(this)">‚ùå</button></td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-add" onclick="addRow()">‚ûï Add Area</button>
      </div>

      <div class="card" style="margin-top:14px;">
        <h3>Blocked Routes (A* will avoid these)</h3>
        <table id="connTable">
          <thead>
            <tr><th>From</th><th>To</th><th>Remove</th></tr>
          </thead>
          <tbody id="connBody">
            <tr>
              <td><input name="from1" placeholder="Area name e.g. A"></td>
              <td><input name="to1" placeholder="Area name e.g. B"></td>
              <td><button type="button" class="btn btn-remove" onclick="removeConn(this)">‚ùå</button></td>
            </tr>
          </tbody>
        </table>
        <button type="button" class="btn btn-add" onclick="addConn()">‚ûï Add Blocked Route</button>
      </div>

      <div class="card" style="margin-top:14px;">
        <h3>Resources</h3>
        Food: <input name="food" type="number" value="0" required> &nbsp;
        Water: <input name="water" type="number" value="0" required> &nbsp;
        Medical: <input name="medical" type="number" value="0" required>
      </div>

      <div style="margin-top:12px; display:flex; gap:12px;">
        <button type="submit" formaction="/optimize_and_route" class="btn btn-opt">
          üöÄ Optimize & Generate Routes
        </button>
      </div>
    </form>

    <div class="row">
      <div class="left">
        {% if allocations %}
        <div class="card">
          <h3>Optimized Allocations</h3>
          <p><strong>Fitness Score:</strong> {{ fitness_score|round(2) }}</p>
          <table>
            <tr><th>Area</th><th>Food</th><th>Water</th><th>Medical</th></tr>
            {% for a in allocations %}
            <tr>
              <td>{{ a.Area }}</td>
              <td>{{ a.Allocated.Food }}</td>
              <td>{{ a.Allocated.Water }}</td>
              <td>{{ a.Allocated.Medical }}</td>
            </tr>
            {% endfor %}
          </table>
          {% if fitness_plot %}
          <div style="margin-top:10px;">
            <h4>Fitness Curve</h4>
            <img src="{{ url_for('static', filename=fitness_plot) }}" width="420" style="border-radius:6px; border:1px solid #ddd;">
          </div>
          {% endif %}
        </div>
        {% endif %}

        {% if route_summary %}
        <div class="card" style="margin-top:14px;">
          <h3>Route Summary</h3>
          <ul>
            {% for line in route_summary %}
              <li>{{ line }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>

      <div class="right">
        {% if route_plot %}
        <div class="card">
          <h3>Route Map</h3>
          <img src="{{ url_for('static', filename=route_plot) }}" width="440" style="border-radius:6px; border:1px solid #ddd;">
          {% if route_order %}
            <h4 style="margin-top:10px;">Route Order</h4>
            <p>HQ ‚Üí {% for n in route_order %} {{ n }} {% if not loop.last %} ‚Üí {% endif %}{% endfor %}</p>
          {% endif %}
        </div>
        {% endif %}
      </div>
    </div>

    {% if message %}
    <div class="message">{{ message }}</div>
    {% endif %}
  </div>

  <script>
    let count = 1;
    function addRow() {
      count += 1;
      const tbody = document.getElementById('areaBody');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input name="area${count}" required></td>
        <td><input name="pop${count}" type="number" value="0" required></td>
        <td><input name="need${count}" placeholder="Food/Water/Medical" required></td>
        <td><input name="x${count}" type="number" step="any" value="0" required></td>
        <td><input name="y${count}" type="number" step="any" value="0" required></td>
        <td><button type="button" class="btn btn-remove" onclick="removeRow(this)">‚ùå</button></td>
      `;
      tbody.appendChild(tr);
    }

    function removeRow(btn) {
      btn.closest('tr').remove();
    }

    let connCount = 1;
    function addConn() {
      connCount++;
      const tbody = document.getElementById('connBody');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input name="from${connCount}" placeholder="From"></td>
        <td><input name="to${connCount}" placeholder="To"></td>
        <td><button type="button" class="btn btn-remove" onclick="removeConn(this)">‚ùå</button></td>
      `;
      tbody.appendChild(tr);
    }
    function removeConn(btn) {
      btn.closest('tr').remove();
    }
  </script>
</body>
</html>
